---
title: PyFluent cheat sheet
format:
  html:
    include-in-header: |
      <style>
      /* De-emphasize import-only code blocks */
      pre code.imports, code.imports {
        font-size: 0.75em;
        line-height: 1.3;
        opacity: 0.85;
      }
      </style>
version: 0.1.0
footer: PyFluent
footerlinks:
  - urls: 'https://fluent.docs.pyansys.com/version/stable/'
    text: Documentation
  - urls: 'https://fluent.docs.pyansys.com/version/stable/getting_started/index.html'
    text: Getting started
  - urls: 'https://fluent.docs.pyansys.com/version/stable/examples/index.html'
    text: Examples
  - urls: 'https://fluent.docs.pyansys.com/version/stable/api/index.html'
    text: API reference
  - urls: 'https://fluent.docs.pyansys.com/version/stable/getting_started/faqs.html'
    text: FAQ
  - urls: 'https://github.com/ansys/pyfluent/discussions'
    text: Discussions
  - urls: 'https://github.com/ansys/pyfluent/issues'
    text: 'Issues'
execute:
  eval: false
jupyter:
  jupytext:
    text_representation:
      extension: .qmd
      format_name: quarto
      format_version: '1.0'
      jupytext_version: 1.16.4
  kernelspec:
    display_name: Python 3 (ipykernel)
    language: python
    name: python3
---


## Session Management

### Launch sessions
```{python .imports}
import ansys.fluent.core as pyfluent
```
```{python}
# Solver mode
solver = pyfluent.Solver.from_install()
# Meshing mode
meshing = pyfluent.Meshing.from_install()

# Connect to existing session
solver = pyfluent.Solver.from_connection(
    ip="127.0.0.1", port=50000, password="password",
    )
meshing = pyfluent.Meshing.from_connection(
    ip="127.0.0.1", port=50000, password="password"
    )
```

### File I/O

```{python .imports}
from ansys.fluent.core.solver import (
    ReadCase,
    ReadCaseData,
    WriteCase,
    WriteCaseData,
    )
from ansys.fluent.core import (
    examples,
    )
mesh_file = examples.download_file(
        "mixing_elbow.msh.h5", "pyfluent/mixing_elbow"
    )

case_file = examples.download_file(
        "mixing_elbow.cas.h5", "pyfluent/mixing_elbow"
    )

data_file = examples.download_file(
        "mixing_elbow.dat.h5", "pyfluent/mixing_elbow"
    )
```
```{python}
# Read case
ReadCase(settings_source=solver)
  (file_name=case_file)
# Read case and data
ReadCaseData(settings_source=solver)
  (file_name=data_file)
# Write files
WriteCase(settings_source=solver)
  (file_name="output.cas.h5")
WriteCaseData(settings_source=solver)
  (file_name="output.cas.h5")
```

## Meshing Workflow

### Watertight geometry workflow

```{python}
file_name = examples.download_file
              ("mixing_elbow.pmdb",
                "pyfluent/mixing_elbow")
watertight = meshing.watertight()
# Import Geometry
watertight.import_geometry.file_name = file_name
watertight.import_geometry.length_unit = "mm"
watertight.import_geometry()
# Surface mesh
surface_mesh = watertight.create_surface_mesh
surface_mesh.cfd_surface_mesh_controls.max_size = 0.3
surface_mesh()
# Describe geometry
watertight.describe_geometry.setup_type = "fluids"
watertight.describe_geometry()
# Update boundaries
ub = watertight.update_boundaries
ub.boundary_label_list
    .set_state(["wall-inlet"])
ub.boundary_label_type_list
    .set_state(["wall"])
ub.old_boundary_label_list
    .set_state(["wall-inlet"])
ub.old_boundary_label_type_list
    .set_state(["velocity-inlet"])
ub()
# Volume mesh
vm = watertight.create_volume_mesh
vm.volume_fill = "poly-hexcore"
vm.volume_fill_controls.hex_max_cell_length = 0.3
vm()
# Switch to solver
solver = meshing.switch_to_solver()
```

## Physics Setup

### Boundary conditions

```{python .imports}
from ansys.fluent.core.solver import VelocityInlet
```
```{python}
bc = solver.settings.setup.boundary_conditions
# Velocity inlet
inlet = VelocityInlet(settings_source=solver, name="cold-inlet")
inlet.momentum.velocity_magnitude = 0.4
inlet.turbulence.turbulence_specification = "Intensity and Hydraulic Diameter"
inlet.turbulence.turbulent_intensity = 0.05
inlet.turbulence.hydraulic_diameter = "4 [in]"
inlet.thermal.temperature = 293.15
```

### Materials

```{python}
# Copy and modify material
materials = solver.settings.setup.materials
air_copy = materials.fluid.make_a_copy(from_="air", to="air-copied"
    )
materials.fluid["air-copied"].viscosity = 1.81e-05
# Create new material
mysolid = materials.solid.create("mysolid")
mysolid.density.value = 2650
mysolid.thermal_conductivity.value = 7.6
```

### Cell zone conditions

```{python}
cz = solver.settings.setup.cell_zone_conditions
cz.fluid["elbow-fluid"].general.material = "air-copied"
```

### Models
```{python .imports}
from ansys.fluent.core.solver import Viscous
```
```{python}
models = solver.settings.setup.models
# Energy
models.energy.enabled = True
models.energy.viscous_dissipation = True
# Viscous
viscous = Viscous(solver)
viscous.model = viscous.model.K_EPSILON
viscous.k_epsilon_model = viscous.k_epsilon_model.REALIZABLE
# Radiation
rad = models.radiation
rad.model = "monte-carlo"
rad.solve_frequency.number_of_histories = 1e7
# Species transport
models.species.model.option = "species-transport"
```
## Solution

```{python .imports}
soln = solver.settings.solution
```

### Solution methods

```{python}
methods = soln.methods
methods.p_v_coupling.flow_scheme = "Coupled"
methods.spatial_discretization.gradient_scheme = "green-gauss-node-based"
```

### Solution controls

```{python}
control = soln.controls
control.p_v_controls.flow_courant_number = 0.5
```

### Report definitions

```{python}
rep_defs = soln.report_definitions
surf_rep = rep_defs.surface["outlet-temp-avg"] = {}
rep_defs.surface["outlet-temp-avg"].report_type = "surface-massavg"
rep_defs.surface["outlet-temp-avg"].field = "temperature"  
```

### Initialize and solve

```{python}
# Initialization
soln.initialization.hybrid_initialize()
# Run calculation
soln.run_calculation.iterate(iter_count=100)
# Check convergence
soln.monitor.residual.plot()
```

## Post-Processing

### Field data access

```{python .imports}
# Ensure the session is initialized before 
# requesting field data
from ansys.fluent.core import (
    ScalarFieldDataRequest,
    VectorFieldDataRequest,
    SurfaceFieldDataRequest,
    PathlinesFieldDataRequest,
    SurfaceDataType,
    )
```
```{python}
field_data = solver.fields.field_data

# Scalar field data (absolute pressure on 
# cold-inlet)
abs_press_req = ScalarFieldDataRequest(
    field_name="absolute-pressure",
    surfaces=["cold-inlet"],
    )
abs_pressure = field_data.get_field_data(abs_press_req)

# Vector field data (velocity on cold-inlet)
vel_req = VectorFieldDataRequest(
    field_name="velocity",
    surfaces=["cold-inlet"],
    )
velocity = field_data.get_field_data(vel_req)

# Surface data (vertices and face centroids on
# hot-inlet and cold-inlet)
surf_req = SurfaceFieldDataRequest(                                      
    data_types=[SurfaceDataType.Vertices, 
                SurfaceDataType.FacesCentroid],
                surfaces=["hot-inlet", "cold-inlet"],
    )
surfaces = field_data.get_field_data(surf_req)

# Access examples
cold_vertices = surfaces["cold-inlet"].vertices
hot_centroids = surfaces["hot-inlet"]
                  .face_centroids
```

### Field info (allowed values, active status, ranges)

```{python .imports} 
# Use ansys.units.VariableCatalog for unit-aware
# field names. Scalars: TEMPERATURE (K), 
# ABSOLUTE_PRESSURE (Pa); vectors: VELOCITY (m/s). 
from ansys.units import VariableCatalog as VC
```
```{python}
# Allowed values
scalar_fields = field_data.scalar_fields
vector_fields = field_data.vector_fields
surface_fields = field_data.surfaces
scalar_names = sorted(scalar_fields.allowed_values())
vector_names = sorted(vector_fields.allowed_values())
surface_names = sorted(surface_fields.allowed_values())

# Active status (variable availability)
temp_active = scalar_fields
                .is_active(VC.TEMPERATURE)
vel_active = vector_fields
                .is_active(VC.VELOCITY)

# Value ranges (numeric range of value for given 
# variable)
temp_range = scalar_fields
              .range("temperature")
vmag_range = scalar_fields
              .range("velocity-magnitude")
```

### Reduction functions

```{python}
reduction = solver.fields.reduction
# Area and volume

location = [solver.setup.boundary_conditions
                  .velocity_inlet["cold-inlet"]]
outlet_location = [solver.setup.boundary_conditions
                  .pressure_outlet["outlet"]]
wall_location = [solver.setup.boundary_conditions
                  .wall["wall-elbow"]]
# Area
area = reduction.area(locations=location)
# Volume
volume = reduction.volume(locations=location)
# Averages and integrals
avg_pressure = reduction.area_average("AbsolutePressure", locations=outlet_location)  
total_mass = reduction.mass_integral("1", locations=outlet_location)
# Force and moment
force = reduction.force(locations=wall_location)
# Min/max
max_vel = reduction.maximum("VelocityMagnitude", locations=wall_location)
```

### Solution variables

```{python}
sv_info = solver.fields.solution_variable_info
sv_data = solver.fields.solution_variable_data
# Get zone info
zones_info = sv_info.get_zones_info()
# Get variable data
temp_data = sv_data.get_data(
    variable_name="SV_T",
    zone_names=["elbow-fluid"], 
    domain_name="mixture"
    )
# Set variable data
temp_array = sv_data.create_empty_array("SV_T", "elbow-fluid", "mixture")
temp_array[:] = 500
sv_data.set_data(
    variable_name="SV_T",
    zone_names_to_data={'elbow-fluid': temp_array},
    domain_name="mixture"
    )
```